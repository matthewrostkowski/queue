<!-- app/views/queues/_show_core.html.erb -->

<div class="queue-page">
  <!-- Header -->
  <div class="queue-header">
    <div class="queue-header-left">
      <div class="app-badge">Queue</div>
      <div class="queue-meta">
        <h1>Live Queue</h1>
        <p>Community-powered playlist</p>
      </div>
    </div>
    <button class="play-queue-btn" onclick="alert('Play functionality coming soon!')">
      â–¶ Play Queue
    </button>
  </div>

  <!-- Flash messages -->
  <% if flash[:notice] %>
    <div class="flash-notice">
      <%= flash[:notice] %>
    </div>
  <% end %>

  <!-- Session info -->
  <div class="session-summary">
    <div class="session-chip">
      <span class="active-dot"></span>
      <span>Live Session</span>
    </div>
    <div style="color:#777;">
      <%= pluralize(@queue_items.count, 'song') %> in queue
    </div>
  </div>

  <!-- Now Playing -->
  <% if @now_playing %>
    <div class="now-playing-card">
      <div class="np-left">
        <div class="np-art" style="background-image: url('<%= @now_playing.cover_url %>');"></div>
        <div class="np-info">
          <div class="np-track"><%= @now_playing.title %></div>
          <div class="np-artist"><%= @now_playing.artist %></div>
          <div class="np-extra">
            <% if @now_playing.duration_ms %>
              <% total_seconds = (@now_playing.duration_ms.to_i / 1000) %>
              <% minutes = total_seconds / 60 %>
              <% seconds = total_seconds % 60 %>
              <%= minutes %>:<%= seconds.to_s.rjust(2,"0") %>
            <% end %>
          </div>
        </div>
      </div>
      <div class="np-right">
        <span class="np-price-value">Now Playing</span>
        <div class="np-score">
          <%= pluralize(@now_playing.vote_score, 'vote') %>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Up Next -->
  <div class="up-next-section">
    <h2 class="section-heading">Up Next</h2>

    <% if @queue_items.empty? %>
      <div class="empty-state">
        <div class="empty-emoji">ðŸŽµ</div>
        <div class="empty-headline">Queue is empty</div>
        <p style="font-size:14px;">Be the first to add a song!</p>
        <a href="/search" style="
          display:inline-block;
          margin-top:16px;
          padding:10px 20px;
          background:#1db954;
          color:#000;
          text-decoration:none;
          border-radius:10px;
          font-weight:600;
        ">
          Search Music
        </a>
      </div>
    <% else %>
      <ul class="queue-list">
        <% @queue_items.each do |item| %>
          <li class="queue-row">
            <div class="qr-left">
              <div class="qr-art" style="background-image: url('<%= item.cover_url %>');"></div>
              <div class="qr-info">
                <div class="qr-track"><%= item.title %></div>
                <div class="qr-artist"><%= item.artist %></div>
                <div class="qr-meta">
                  Added by <%= item.user_display_name || 'Guest' %>
                  <% if item.duration_ms %>
                    <% total_seconds = (item.duration_ms.to_i / 1000) %>
                    <% minutes = total_seconds / 60 %>
                    <% seconds = total_seconds % 60 %>
                    â€¢ <%= minutes %>:<%= seconds.to_s.rjust(2,"0") %>
                  <% end %>
                </div>
              </div>
            </div>

            <div class="qr-right">
              <div class="qr-vote-block">
                <%= button_to "+", upvote_queue_item_path(item), 
                      method: :post, 
                      class: "vote-btn" %>
                <span class="qr-votes-number"><%= item.vote_score %></span>
                <%= button_to "âˆ’", downvote_queue_item_path(item), 
                      method: :post, 
                      class: "vote-btn" %>
              </div>
              <div class="qr-score">
                Score: <%= item.vote_score %>
              </div>
            </div>
          </li>
        <% end %>
      </ul>

      <div style="margin-top:24px;text-align:center;">
        <a href="/search" style="
          display:inline-block;
          padding:10px 20px;
          background:#1a1a1a;
          color:#1db954;
          text-decoration:none;
          border-radius:10px;
          border:1px solid #333;
          font-weight:600;
        ">
          + Add More Songs
        </a>
      </div>
    <% end %>
  </div>
</div>
